#!/bin/sh
#
# Make `Installing HPCM' document.
#
# File:		installing_hpcm
# Author:	Bob Walton (walton@deas.harvard.edu)
# Date:		Tue Apr  1 05:41:21 EST 2003
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: hc3 $
#   $Date: 2003/04/01 10:40:57 $
#   $RCSfile: installing_hpcm,v $
#   $Revision: 1.13 $
#
# The next line starts tcl \
exec tcl "$0" "$@"

# Use tcl rather than tclsh so that `signal' is defined.

# Include common code and parameters:
#
set lib_directory "[file dirname $argv0]/../lib"
source $lib_directory/judging_common.tcl
set log_mode none
catch {

puts "
		     Installing HPCM
		     ---------- ----


Information about HPCM
----------- ----- ----

The web page for HPCM is:

	www.deas.harvard.edu/~hc3/hpcm

There is an overview of HPCM that tells what the system
does.


Installation of HPCM
------------ -- ----

1. Read the `Requirements' section of the Overview docu-
   ment (hpcm/judge/bin/overview) and import if neces-
   sary GNU bash, TCL, JAVA, and CLISP.

2. Create a judging account and be sure its umask is
   set to disallow other accounts from reading files
   and directories in the judging account.  The
   following is to be done within the judging account.

3. Import the HPCM system into ~/hpcm.  This can be
   done by untaring the hpcm_*_*.tgz file while the
   current directory is ~ (*_* is the version and sub-
   version; a .tgz file is a gzipped .tar file).  It is
   also possible to put the hpcm system elsewhere.  The
   example contests assume HPCM is installed in ~/hpcm,
   but they can be modified if HPCM is installed else-
   where.

4. Assuming /sbin is the right directory for secure
   root setuid programs, run:

		cd ~/hpcm/secure/src
		su
		make root_install
		exit

   This installs the hpcm_sandbox program as a setuid
   root program in the system /sbin directory, which
   is the appropriate thing for Linux.  If you put
   this setuid binary in another place, say `/foo',
   you should replace the `make' command above by

		make SECURE_BIN=/foo root_install

   After doing `root_install', create a user account
   named `sandbox'.  This user should never log in (but
   it is harmless if the user does).  Any files owned
   by this user account should be considered insecure.

   If you skip this step, an insecure hpcm_sandbox
   will be installed (in the next step) for the
   judge, which will mean that malicious contestant
   programs could corrupt the judging files.

5. Run		cd ~/hpcm
		make

   This sets some file modes, makes a few binary files,
   and makes the judge's documentation files in hpcm/
   judge/doc.

   The judge's documentation for any HPCM program is
   made by running the program with the `-doc' option.
   This is done in hpcm/judge/doc to create a .txt docu-
   ment file for each program.  This document, for exam-
   ple, is generated by running `installing_hpcm -doc'.

   There is also significant documentation in the hpcm/
   judge/lib directory files hpcm_judging.rc and *.tcl.

   All the judge's documentation can be printed by
   `make fprint' in hpcm/judge/doc.

   Look at the STATUS file to find out about deficien-
   cies and changes in the version you have gotten.

6. Put ~/hpcm/judge/bin in the PATH of the current
   (judge's) account.  Do NOT put ~/hpcm/contestant/
   bin in that PATH.

7. If you get a new version of HPCM, just repeat steps
   3 and 5.   It may be well to execute

   	mv ~/hpcm ~/hpcm~

   first to save the old hpcm, in case there are any
   differences you want to check later (using diff).
   If the ~/hpcm/secure/src/hpcm_sandbox.c file has
   changed, you will also have to repeat step 4."

exit 0

# Include common error catching code:
#
} caught_output
caught_error
