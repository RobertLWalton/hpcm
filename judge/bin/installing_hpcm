#!/bin/sh
#
# Make `Installing HPCM' document.
#
# File:		installing_hpcm
# Author:	Bob Walton (walton@deas.harvard.edu)
# Date:		Wed Jan 10 06:39:26 EST 2001
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: hc3 $
#   $Date: 2001/01/10 12:25:08 $
#   $RCSfile: installing_hpcm,v $
#   $Revision: 1.6 $
#
# The next line starts tcl \
exec tcl "$0" "$@"

# Use tcl rather than tclsh so that `signal' is defined.

# Include common code and parameters:
#
set lib_directory "[file dirname $argv0]/../lib"
source $lib_directory/judging_common.tcl
set log_mode none
catch {

puts "
		     Installing HPCM
		     ---------- ----


Information about HPCM
----------- ----- ----

The web page for HPCM is:

	www.deas.harvard.edu/~hc3/hpcm

There is an overview of HPCM that tells what the system
does.


Requirements
------------

HPCM currently requires a UNIX system with Bourne shell
and TCL language interpreters.

A couple of programs require the `read -r' Bourne
shell command, and a Bourne shell `echo' command that
does not specially interpret the `\\' character.  If you
are using a UNIX system whose Bourne shell does not
support these features, the simplest fix is to import
the GNU Bourne shell, bash, and fix the programs con-
taining `read -r' to use it (these programs are current-
ly hpcm_extract and SET_PROTOTYPE).

Only the judging account needs to run TCL.  Only
contestant accounts (including the prototype account)
need `read -r'.

TCL can be obtained at:	 	www.scriptics.com

Bash can be obtained at:

	www.gnu.org/software/bash/bash.html


Installation of HPCM
------------ -- ----

1. Create a judging account and be sure its umask is
   set to disallow other accounts from reading files
   and directories in the judging account.  The
   following is to be done within the judging account.

2. Import the HPCM system into ~/hpcm.  This can be
   done by untaring the hpcm.tar file while the
   current directory is ~.  It is also possible to
   put the hpcm system elsewhere.  The example
   contests assume HPCM is installed in ~/hpcm,
   but they can be modified if HPCM is installed
   elsewhere.

3. Assuming /sbin is the right directory for secure
   root setuid programs, run:

		cd ~/hpcm/secure/src
		su
		make root_install
		exit

   This installs the hpcm_sandbox program as a setuid
   root program in the system /sbin directory, which
   is the appropriate thing for Linux.  If you put
   this setuid binary in another place, say `/foo',
   you should replace the `make' command above by

		make SECURE_BIN=/foo root_install

   If you skip this step, an insecure hpcm_sandbox
   will be installed (in the next step) for the
   judge, which will mean that malicious contestant
   programs could corrupt the judging files.

4. Run		cd ~/hpcm
		make

   This sets some file modes, makes a few binary files,
   and makes the judge's documentation files in hpcm/
   judge/doc.

   The judge's documentation for any HPCM program is
   made by running the program with the `-doc' option.
   This is done in hpcm/judge/doc to create a .doc
   file for each program.  This document, for example,
   is generated by running `installing_hpcm -doc'.

   Look at the STATUS file to find out about deficien-
   cies and changes in the version you have gotten.

5. Put ~/hcpm/judge/bin in the PATH of the current
   (judge's) account.  Do NOT put ~/hpcm/contestant/
   bin in that PATH.

6. If you get a new version of HPCM, just repeat steps
   2 and 4.   It may be well to execute

   	mv ~/hpcm ~/hpcm~

   first to save the old hpcm, in case there are any
   differences you want to check later (using diff).
   If the ~/hpcm/secure/src/hpcm_sandbox.c file has
   changed, you will also have to repeat step 3."

exit 0

# Include common error catching code:
#
} caught_output
caught_error
