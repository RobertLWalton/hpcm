#! /bin/sh
#
# Test problem code.
#
# File:		testproblems
# Author:	Bob Walton <walton@deas.harvard.edu>
# Date:		Sun Jan 18 08:48:45 EST 2004
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: hc3 $
#   $Date: 2004/01/18 13:58:43 $
#   $RCSfile: testproblems,v $
#   $Revision: 1.7 $

case "$1" in
    "" | -* )
	    echo "
testproblems directory ...

    							
    This program runs:

    		make clean
		make
		diff *.out *.test
		make clean

    in each directory.  It saves the diff outputs in
    addition to outputting them, and then plays back
    all the saved output at the end of this program's
    execution.
    
    If a non-directory is given the program, the
    program merely notes this in the output."

	    exit 1
	    ;;
esac

tmp=/tmp/testproblems$$

trap "rm -f $tmp" 0
echo >$tmp

for x in "$@"
do
    if test \! -d $x; then
	echo "$x is not a directory"
	continue
    fi

    echo "========== $x:" >>$tmp

    (cd $x; make clean; \
            make; \
	    diff *.out *.test 2>&1 | tee -a $tmp; \
	    make clean)
done

cat $tmp

exit 0
