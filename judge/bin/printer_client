#! /bin/sh
#
# Get and print files from remote queue.
#
# File:		printer_client
# Author:	Bob Walton <walton@deas.harvard.edu>
# Date:		Sat Oct  8 13:54:44 EDT 2016
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.

# NOTE: This file is not to be executed by the judge,
#       but is to be sent to whoever needs to print
#       files in printer queues set up by the judge.

case "$1" in
   "" | -* )
   	echo "
printer_client PRIVATE-KEY REMOTE-ACCOUNT PRINTER

    Get files queued for printing in a remote queue and
    print them on a local printer.  The PRIVATE-KEY is
    a file containing an ssh private key.  The REMOTE-
    ACCOUNT is an ssh login account name and names the
    remote queue.  The PRINTER is the local printer.

    The authorized_keys file of the REMOTE-ACCOUNT must
    contain the line

        command=\"printer_server QUEUE-DIRECTORY\" ...

    which invokes the printer_server program that works
    with printer_client to move files to be printed
    from the remote QUEUE-DIRECTORY to the current
    directory and from there to the printer.

    Printer_client reads and executes commands from its
    standard input.  If no input is received within a
    set time (default 30 seconds), printer_client exe-
    cutes the \`get' command which gets and prints any
    unprinted queue files, and then resumes waiting for
    another command (or another timeout).  Files to be
    printed are put in the local (printer_client's)
    current directory with extension .ps, and when the
    file is printed, its extension there is changed to
    .done.

    The common commands are:

        get	Get any unprinted files and print them.
		Files in the queue with extension .ps
		are copied to the current directory
		(of the printer_client program).  Then
		they are printed and their extension
		is changed to .done in both the server
		queue and in the current printer_
		client directory.

	list	List recent files.  Ready (.ps) files
		and recently printed (recent .done)
		files are listed.

	time SECONDS
		Reset the time interval between when
		printer_client is ready to read the
		next command and when it executes an
		automatic \`get' command.  The interval
		time is in seconds, with default of 30
		seconds.  The value 0 means infinity.

    Other occassionally useful command are:

	listall	List all the files in the server queue.
		File names have date and time and are
		in cronological order.  File extensions
		are changed to indicate status:

		    .out    Still being written.
		    .ps	    Ready to print.
		    .done   Printed.

	get FILE
		Copy FILE from server into current
		directory.

	sum FILE
		Check that the server and the local
		directory both have a copy of FILE and
		both copies have the same MD5 sum.
		The extension may be .ps or .done and
		need not match the extension of either
		copy of the file if that extension is
		either .ps or .done.

	print FILE
		Ditto but then print file and if its
		extension is .ps, change its extension
		to .done in current and server
		directories.

	done FILE
		If FILE has the .ps extension, just
		change the extension to .done in the
		current and server directories.

	ready FILE
		If FILE has the .done extension, just
		change the extension to .ps in the
		current and server directories.

	debug [on|off]
		If the debug switch is on, a trace of
		communications between printer_client
		and the remote server is printed.  With
		no option, the switch is toggled.  The
		\`on' and \`off' options set the switch.

		Lines sent to the server are prefaced
		with \`>> ', and lines received from the
		server are prefaced with \`<< '.  See
		\`printer_server -doc' for documentation
		describing the traced lines.
"	| less -F -K
    	exit 1
	;;
esac


key="$1"
account="$2"
printer="$3"

TBD

while read -r
do
    case "$REPLY" in
    esac
done

exit 0
