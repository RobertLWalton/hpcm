#!/bin/sh
#
# Make judge's judging document.
#
# File:		judging
# Author:	Bob Walton (walton@deas.harvard.edu)
# Date:		Fri Nov  9 08:33:13 EST 2001
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: hc3 $
#   $Date: 2001/11/09 14:05:24 $
#   $RCSfile: judging,v $
#   $Revision: 1.5 $
#
# The next line starts tcl \
exec tcl "$0" "$@"

# Use tcl rather than tclsh so that `signal' is defined.

# Include common code and parameters:
#
set lib_directory "[file dirname $argv0]/../lib"
source $lib_directory/judging_common.tcl
set log_mode none
catch {

puts "
		     HPCM Judging
		     ---- -------

	Making Judging Accounts
	Making a Contest
	Judging a Formal Contest
	Auxilary Judging
	Formal Contest Emergencies
	Judging non-Formal Contests

Making Judging Accounts
------ ------- --------

A judging account is a normal user account with the
following special considerations.

If the judging account has its own group, the umask
should be set by

	umask 27

which disables access except by the judging account and
its group, and disables write access by the judging
group.  This permits auxilary judging accounts (see
below).

If the judging account has a shared group, the umask
should be set by

	umask 77

Autologout should be disabled if csh or tcsh is being
used by

	unset autologout

It is a good idea to capture ALL email arriving at the
judging account, just in case there are questions of
lost mail.  This can be done by putting

    :0 c:
    hpcm_mbox

at the beginning of the ~/.procmailrc file, on UNIX
systems that use procmail.  On UNIX systems that use
forwarding, the ~/.forward file can be set to

    \JJJ, /home/JJJ/hpcm_mbox

to store all mail in ~/hpcm_mbox, where JJJ is the
judging account name and /home/JJJ is the home directory
of that account.

[TBD: turn on mail.]

If the judge may want to use facilities that are
normally used by contestants or by auxilary judges,
then it will be necessary to symbolically link
~/.hpcm_contest to the contest directory.  E.g., use

    ln -s ~/contest... ~/.hpcm_contest


Hpcm must be installed in the judging directory: see
the separate document `Installing HPCM'.  This typically
installs HPCM in the ~/hpcm directory and puts the
~/hpcm/judge/bin directory in the PATH of the judging
account.

Making a Contest
------ - -------

One judging account can have many different contests.

To make a new contest, select the contest type TTT you
want, and follow the instructions in

    hpcm/examples/TTT_contest/Makefile


Judging a Formal Contest
------- - ------ -------

You should review Formal Contest Emergencies before
judging a formal contest.

After setting up the contest, one should do the
following:

1.  Run `startcontest' when the contest starts to make
    the problems gettable by the contestants using
    `hpcm_get'.

2.  Check submissions and queries by running the
    `tracker' program.  This program finds submissions
    (including queries) that you have not yet responded
    to.  One can also use the `lookat' program to check
    up on things you have already responded to.


Auxilary Judging
-------- -------

An auxilary judging account is an account that can read
files in the main judging account but cannot write
files.
 
To set up auxilary judging accounts, be sure the main
judging account has its own private UNIX group.  Then
add the auxilary account to this group.  In some UNIX
systems (RedHat Linux), this is done by root executing

	gpasswd -a auxilary-account judging-group

Next, one change the statement `source ~/...' near the
beginning of the hpcm_judging.rc file in the judging
directory to `source /home/JJJ/...', where JJJ is the
name of the main judging account.  This is because the
hpcm_judging.rc file is going to be sourced by auxilary
judging accounts for which `~' will mean the wrong
thing.

One must add the main judging account's hpcm/judge/bin
directory to the PATH of the auxilary account.  This
might be done by putting

	setenv PATH "/home/JJJ/hpcm/judge/bin:$PATH"

in the .cshrc file of the auxilary account, for example,
where JJJ is the name of the main judging account.

Like the judging account, one should turn off autologout
and set an appropriate umask (77 will do) in an auxilary
account.

In the auxilary account you need to link ~/.hpcm_contest
to the contest directory in the main judging account,
JJJ.  This can be done by

	ln -s /home/JJJ/contest* ~/.hpcm_contest

So that the auxilarly judges can quickly find the
judging directory, you may want to link it symbolically
to ~/judge (HPCM software does not use this).  You can
do this by

	ln -s /home/JJJ/judging* ~/judge



Formal Contest Emergencies
------ ------- -----------

In order to prepare for formal emergencies, be sure
you have manpower and means to contact the teams.  If
you are working at one site, have an extra person on
hand.  If you are working with distributed sites, be
sure you have phone numbers for the site managers, and
vice versa, and the phones are tested before the contest
begins.  You may want site managers, who tend to roam,
have cell phones (which could be borrowed).

To prepare to judge an formal contest that you really
want to work, yout should read the documentation and
in some cases the code of the very few programs that are
involved in actual judging.  These are:

    receivemail		Read documentation.

    dispatchmail	Read documentation and code.
    			Code is in hpcm/judge/bin.

    autojudge		Read documentation and code.
    			Code is in hpcm/judge/bin.

    autoscore		Read documention and code.
    			Code is in hpcm/judge/bin.

    scorediff		Read documentation.


Some of these programs call procedures in

	hcpm/judge/lib/judging_common.tcl
	hcpm/judge/lib/scoring_common.tcl
	
and use parameters or procedures defined in

	hpcm/judge/lib/hpcm_judging.rc
	
Read the documentation in these files as necessary.
It should not be necessary to read code.

Particular attention should be paid to being sure that
email works on the day of the contest.  Two solutions
are: have everyone on one machine, so email is internal
to that machine; or have an email guru available to fix
problems with email.

The following is an example emergency from BOSPRE 2001.
It illustrates what can happen and how to fix the
situation.

TBD




Judging non-Formal Contests
------- ---------- --------

"

exit 0

# Include common error catching code:
#
} caught_output
caught_error
