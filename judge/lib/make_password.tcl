# Password Creator TCL Code
#
# File:		make_password.tcl
# Author:	Bob Walton (walton@seas.harvard.edu)
# Date:		Thu Sep 13 05:41:38 EDT 2018
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# Include this code in TCL program via:
#
#	.. include judging_common.tcl first ..
#	source $lib_directory/judging_common.tcl

# Return a 32 bit password of the form WWWDDWWWDD where
# each WWW is a 3 letter word from /usr/dict/words that
# is of the form [a-z][aeiou][a-z], and D is a random
# decimal digit in the range [2-9].  WWW is chosen from
# a list of 1024 words.
#
# Uses /dev/random if available.  Keeps statistics for
# password_statistics.
#
set dev_random_passwords 0
set rand_passwords 0
proc make_password {} {
    global dev_random_passwords rand_passwords
    if { [file readable /dev/random] } {
        if { $dev_random_passwords == 0 } {
	    puts "Making passwords from /dev/random"
	}
        incr dev_random_passwords
	# For some reason we cannot read /dev/random
	# directly from tclsh on all systems.
	set data [exec hpcm_read_random]
	set r1 [lindex $data 0]
	set r2 [lindex $data 1]
    } else {
	incr rand_passwords
        set r1hi [expr int ( rand() * 256 ) % 256 ]
        set r1lo [expr int ( rand() * 256 ) % 256 ]
        set r2hi [expr int ( rand() * 256 ) % 256 ]
        set r2lo [expr int ( rand() * 256 ) % 256 ]
	puts "BYTES $r1hi $r1lo $r2hi $r2lo"
	set r1 [expr ( $r1hi << 8 ) + $r1lo]
	set r2 [expr ( $r2hi << 8 ) + $r2lo]
    }
    global make_password_dictionary
    set len [llength $make_password_dictionary]
    set w1 [lindex $make_password_dictionary \
    		   [expr $r1 % $len] ]
    set d1 [lindex [expr ( $r1 >> 10 ) % 8 + 2]]
    set d2 [lindex [expr ( $r1 >> 13 ) % 8 + 2]]
    set w2 [lindex $make_password_dictionary \
    		   [expr $r2 % $len] ]
    set d3 [lindex [expr ( $r2 >> 10 ) % 8 + 2]]
    set d4 [lindex [expr ( $r2 >> 13 ) % 8 + 2]]
    return "$w1$d1$d2$w2$d3$d4"
}

# Returns a message giving password statistics.
# If no passwords made the message is "".
#
proc password_statistics {} {
    global dev_random_passwords rand_passwords
    if { $dev_random_passwords > 0 } {
        if { $rand_passwords > 0 } {
	    return "Made $dev_random_passwords\
	            /dev/random passwords and\
		    $rand_passwords rand()\
		    passwords."
	} else {
	    return "Made $dev_random_passwords\
	            /dev/random passwords."
	}
    } else {
        if { $rand_passwords > 0 } {
	    return "Made $rand_passwords rand()\
	            passwords."
	} else {
	    return ""
	}
    }
}

# Zero password statistics.  Statistics are zero on
# initial load, so it may not be necessary to call this.
#
proc zero_password_statistics {} {
    global dev_random_passwords rand_passwords
    set dev_random_passwords 0
    set rand_passwords 0
}

# These are 3 lower case letter words taken from
# /usr/share/dict/words that have the form
# consonant vowel letter, with some deletions.
# There are a bit over 2**10 words.
#
set make_password_dictionary {
bab
bac
bad
bae
bag
bah
bai
bal
bam
ban
bap
bar
bas
bat
baw
bay
bec
bed
bee
bef
beg
bel
ben
ber
bes
bet
bey
bib
bid
big
bim
bin
bio
bis
bit
biz
boa
bob
boc
bod
boe
bog
boh
bol
bom
bon
bop
bor
bos
bot
bow
box
boy
bub
bud
bug
bul
bum
bun
bur
bus
but
buy
buz
cab
cad
caf
cag
cai
cal
cam
can
cap
car
cat
cav
caw
cay
cen
cep
cia
cid
cie
cif
cig
cir
cis
cit
civ
cob
cod
coe
cog
col
com
con
cop
cor
cos
cot
cow
cox
coy
coz
cub
cud
cue
cuj
cul
cum
cun
cup
cur
cut
dab
dad
dae
dag
dah
dak
dal
dam
dan
dao
dap
dar
das
dat
dau
daw
day
dea
deb
dec
def
deg
dei
del
dem
den
dep
der
des
det
dev
dew
dex
dey
dia
dib
did
die
dif
dig
dil
dim
din
dip
dir
dis
dit
div
dix
doa
dob
doc
dod
doe
dog
doh
dol
dom
don
dop
dor
dos
dot
dow
doz
dub
duc
dud
due
dug
dui
dum
dun
duo
dup
dur
dux
fab
fac
fad
fae
fag
fam
fan
faq
far
fas
fat
fax
fay
fec
fed
fee
feh
fei
fem
fen
fer
fet
feu
few
fey
fez
fib
fid
fie
fig
fil
fin
fip
fir
fit
fix
fiz
fob
fod
foe
fog
foh
fol
fon
fop
for
fot
fou
fow
fox
foy
fub
fud
fug
fum
fun
fur
fut
gab
gad
gae
gag
gaj
gal
gam
gan
gap
gar
gas
gat
gau
gaw
gay
gaz
geb
ged
gel
gem
gen
geo
ger
get
gey
gez
gib
gid
gie
gif
gig
gim
gin
gio
gip
gis
git
goa
gob
god
gog
goi
gol
gon
gor
gos
got
gou
gov
gox
goy
gud
gue
gul
gum
gun
gup
gur
gut
guv
guy
guz
hab
had
hae
haf
hag
hah
haj
hak
ham
han
hao
hap
has
hat
hau
hav
haw
hay
hed
heh
hei
hel
hem
hen
heo
hep
her
hes
het
hew
hex
hey
hia
hic
hid
hie
him
hin
hip
hir
his
hit
hob
hoc
hod
hoe
hog
hoi
hol
hom
hon
hop
hor
hot
how
hox
hoy
hub
hud
hue
hug
huh
hum
hun
hup
hut
jab
jad
jag
jah
jai
jak
jam
jap
jar
jat
jaw
jay
jed
jeg
jen
jer
jet
jeu
jew
jib
jig
jim
jin
job
joe
jog
jot
jow
joy
jud
jug
jun
jus
jut
juv
kab
kae
kaf
kai
kal
kam
kan
kas
kat
kaw
kay
kea
keb
ked
kef
keg
ken
kep
ket
kev
kex
key
kid
kie
kif
kil
kim
kin
kip
kir
kit
koa
kob
koi
kon
kop
kor
kos
kou
kue
lab
lac
lad
lag
lah
lai
lak
lam
lan
lao
lap
lar
las
lat
lav
law
lax
lay
lea
led
lee
leg
lei
lek
leo
lep
les
let
leu
lev
lew
lex
ley
lez
lib
lid
lie
lif
lig
lim
lin
lip
liq
lir
lis
lit
loa
lob
loc
lod
loe
lof
log
lop
loq
lor
lot
low
lox
loy
lub
lud
lue
lug
lum
lur
lut
luv
lux
mab
mac
mad
mae
mag
mal
mam
man
mao
map
mar
mas
mat
mau
maw
max
may
mea
med
meg
mel
mem
men
meq
mer
met
meu
mew
mia
mib
mid
mig
mil
mim
min
mir
mis
mit
mix
moa
mob
moc
mod
moe
mog
moi
mol
mom
mon
mop
mor
mos
mot
mou
mow
moy
mud
mug
mum
mun
mus
mut
mux
nab
nad
nae
naf
nag
nah
nak
nam
nan
nap
nar
nat
nav
naw
nay
nea
neb
nef
neg
nei
nek
neo
nep
net
new
nib
nid
nig
nil
nim
nip
nis
nit
nix
noa
nob
nod
nog
noh
nol
nom
non
nor
nos
not
nov
now
nox
noy
nub
nul
num
nun
nus
nut
pac
pad
pah
pal
pam
pan
pap
par
pas
pat
pau
pav
paw
pax
pay
pea
ped
peg
peh
pen
pep
per
pes
pet
pew
pia
pic
pie
pig
pik
pil
pin
pip
pir
pis
pit
piu
pix
poa
pob
pod
poe
poh
poi
pol
pom
pon
pop
por
pos
pot
pow
pox
poy
poz
pua
pub
pud
pug
pul
pun
pup
pur
pus
put
puy
qaf
qat
qed
qid
qua
que
qui
quo
rab
rad
rag
rah
raj
ram
ran
rap
ras
rat
raw
rax
ray
rea
reb
rec
red
ref
reg
reh
rei
rel
rem
ren
rep
req
res
ret
rev
rew
rex
ria
rib
rid
rie
rif
rig
rim
rin
rio
rip
rit
riv
rix
rob
roc
rod
roe
rog
roi
rom
ros
rot
row
rox
rub
rud
rue
rug
rum
run
rut
rux
sab
sac
sad
sae
sag
sah
sai
saj
sal
sam
san
sao
sap
sar
sat
sau
sav
saw
sax
say
sea
sec
sed
see
seg
sei
sel
sem
sen
sep
seq
ser
set
sew
sex
sey
sib
sic
sie
sig
sil
sim
sin
sip
sir
sis
sit
six
sob
soc
sod
soe
sog
soh
sok
sol
son
sop
sos
sot
sou
sov
sow
sox
soy
sub
sud
sue
suf
sui
sum
sun
sup
suq
sur
suz
tab
tad
tae
tag
tai
taj
tal
tam
tan
tao
tap
tar
tas
tat
tau
tav
taw
tax
tay
tea
tec
ted
tee
tef
teg
tel
tem
ten
ter
tet
tew
tex
tez
tib
tic
tid
tie
tig
til
tim
tin
tip
tis
tit
tiu
toa
tob
tod
toe
tog
toi
tol
tom
ton
top
tor
tos
tot
tou
tov
tow
tox
toy
tua
tub
tue
tug
tui
tum
tun
tup
tur
tut
tux
tuy
vac
vag
val
van
var
vas
vat
vau
vav
vaw
vax
veg
vei
vel
ver
vet
vex
via
vic
vie
vig
vil
vim
vin
vip
vis
viz
voc
voe
vog
vol
von
vow
vox
vug
vum
wab
wac
wad
wae
waf
wag
wah
wan
wap
war
was
wat
waw
wax
way
web
wed
wef
wem
wen
wer
wet
wey
wid
wig
wim
win
wir
wis
wit
wiz
woa
wob
wod
woe
wog
wok
won
wop
wos
wot
wow
woy
wud
wun
wup
wur
wus
wut
xat
xed
xis
xiv
xix
yad
yah
yak
yam
yan
yap
yar
yas
yat
yaw
yay
yea
yed
yeh
yen
yeo
yep
yer
yes
yet
yew
yid
yin
yip
yis
yob
yod
yoe
yoi
yok
yom
yon
yor
yot
you
yow
yox
yoy
yug
yuh
yuk
yum
yup
yus
zac
zad
zag
zak
zap
zar
zat
zax
zea
zed
zek
zel
zen
zep
zer
zig
zip
zit
zoa
zod
}
