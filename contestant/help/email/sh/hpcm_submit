#!/bin/sh -f
#
# Submit a file.
#
# File:		hpcm_submit
# Author:	Bob Walton <walton@deas.harvard.edu>
# Date:		Sun Sep 10 15:46:13 EDT 2000
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: acm-cont $
#   $Date: 2000/09/10 19:52:07 $
#   $RCSfile: hpcm_submit,v $
#   $Revision: 1.6 $

# If you have a linux system you can symbolically
# link this to ~/bin/hpcm_submit and use the problem
# Makefiles.  This will probably also work for other
# UNIX systems, but you may have to change the mail(1)
# program to something else, like mailx(1).  See below
# for comments relating to SUN UNIX operating systems.

case "$1" in
    "" | -*)
    		echo "
hpcm_submit program

	Submits the program to the email address named
	in the environment variable HPCM_SUBMIT_ADDRESS.
	The program is given without extension, e.g.,
	without .c or .cc: the extension is added auto-
	matically and the program source is submitted by
	email."

		exit 1
		;;
esac

# Locate the program file name, with extension.  If
# there is more than one, determine a list of extras.
#
program=""
extras=""
for e in .c .cc .java .p; do
    if test -r $1$e; then
        if test "$program" = ""; then
	    program=$1$e
	else
	    extras="$extras $1$e"
	fi
    fi
done

# Complain if there is not exactly one program file
# with extension.
#
if test "$program" = ""; then
    echo "ERROR: no files to submit"
    exit 1
elif test "$extras" != ""; then
    echo "ERROR: too many files to submit:"
    echo "       $program$extras"
    exit 1
fi

# Submit program file by email.
#
( echo BEGIN $program; \
  cat $program | sed -e '/^/s//../'; \
  echo END $program ) \
| mail -s "submit $program" $HPCM_SUBMIT_ADDRESS $USER
#
# For SUN UNIX operating systems change `mail' to 
# `mailx' just above.
