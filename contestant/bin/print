#! /bin/sh
#
# Print files in 60 line x 80 column format.
#
# File:		fprint
# Author:	Bob Walton <walton@deas.harvard.edu>
# Date:		Sat Dec  9 13:20:06 EST 2000
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: hc3 $
#   $Date: 2000/12/09 18:20:30 $
#   $RCSfile: print,v $
#   $Revision: 1.10 $

case "$1" in
   -doc* )
   	echo "
fprint [filename ...]

    Print the files named (or the standard input if
    the filenames are missing) in a format well suited
    to files with lines of 80 columns.   This format
    puts 1 file page per paper page, and permits at
    least 60 lines on a file page.

    If ~/.hpcm_contest/printer is readable the name of
    the printer is read from this file.

    If ~/.hpcm_contest/who_where is readable the name of
    the current account is mapped so this file's WHERE
    field is printed in the page header in place of the
    current account name.

    If ~/.hpcm_contest/printer_jobs is writable a line
    giving the date and WHERE field (or account name)
    is written to that file."

    	exit 1
	;;
esac


# Compute `where' from who_where if that exists.
#
user=`id -un`

if test -r ${HOME}/.hpcm_contest/who_where; then
    whowhere=`grep "^$user:" \
                   ${HOME}/.hpcm_contest/who_where`
    where=`echo "$whowhere" | cut -d: -f2`
    case "$where" in
    "" | WHERE | where )
        where="$user"
	;;
    esac
else
    where="$user"
fi

# Compute printer.
#
if test -r ${HOME}/.hpcm_contest/printer; then
    PRINTER=`cat ${HOME}/.hpcm_contest/printer`
fi

# If printer_jobs exists, announce print job therein.
#
if test -w ${HOME}/.hpcm_contest/printer_jobs; then
    line="`date`   ***   $where"
    echo "$line" >> ${HOME}/.hpcm_contest/printer_jobs
fi

# Print files.
#
enscript -j -b "\$n|%W  %C  $where|\$% of \$=" \
	-F Courier-Bold12 -f Courier11 -P $PRINTER "$@"

exit 0
