#! /bin/sh
#
# Print files in 40 line x 56 column format.
#
# File:		fprint
# Author:	Bob Walton <walton@deas.harvard.edu>
# Date:		Sun Nov 12 04:38:44 EST 2000
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: hc3 $
#   $Date: 2000/11/12 10:24:48 $
#   $RCSfile: fprint,v $
#   $Revision: 1.5 $

case "$1" in
   -doc* )
   	echo "
fprint [filename ...]

    Print the files named (or the standard input if
    the filenames are missing) in a format well suited
    to files with lines of 56 columns.   This format
    puts 2 file pages per paper page, and permits at
    least 40 lines on a file page.

    If ~/.hpcm_contest/printer is readable the name of
    the printer is read from this file.

    If ~/.hpcm_contest/who_where is readable the name of
    the current account is mapped so this file's WHERE
    field is printed in the page header in place of the
    current account name.

    If ~/.hpcm_contest/printer_jobs is writable a line
    giving the date and WHERE field (or account name)
    is written to that file."

    	exit 1
	;;
esac


# Compute `where' from who_where if that exists.
#
user=`id -un`

if test -r ~/.hpcm_contest/who_where; then
    whowhere=`grep "^$user:" ~/.hpcm_contest/who_where`
    if test -z "$whowhere"; then
        where="$user"
    else
	where=`echo "$whowhere" | cut -d: -f2`
    fi
else
    where="$user"
fi

# Compute printer.
#
if test -r ~/.hpcm_contest/printer; then
    PRINTER=`cat ~/.hpcm_contest/printer`
fi

# If printer_jobs exists, announce print job therein.
#
if test -w ~/.hpcm_contest/printer_jobs; then
    line="`date`   ***   $where"
    echo "$line" >> ~/.hpcm_contest/printer_jobs
fi

# Print files.
#
enscript -j -2r -b "\$n|%E  %C  $where|\$% of \$=" \
	-F Courier-Bold14 -f Courier10 -P $PRINTER "$@"

exit 0
