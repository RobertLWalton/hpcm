#!/bin/sh
#
# Run jdb on a java program.
#
# File:		jdebug
# Author:	Bob Walton <walton@deas.harvard.edu>
# Date:		Thu Jan 10 11:45:35 EST 2013
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: walton $
#   $Date: 2013/01/10 17:24:27 $
#   $RCSfile: jdebug,v $
#   $Revision: 1.1 $

case "$1" in
     -doc* )
     		echo "
jdebug program inputfile

    Invokes the jdb debugger on an instance of

    	java -ae program < inputfile

    Here -ae enables assert statement execution.
    jdb and the program share the standard output,
    but have separate standard inputs."

    		exit 1
		;;
esac

address=`expr \( $$ \% 50000 \) + 10000` 
agent=-agentlib:jdwp=transport=dt_socket
java $agent,address=$address,server=y,suspend=y $1 <$2 &

child=$!

jdb -attach $address

kill -9 $child
