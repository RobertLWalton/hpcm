#!/bin/sh
#
# Submit a file.
#
# File:		hpcm_submit
# Author:	Bob Walton <walton@deas.harvard.edu>
# Date:		Sun Jan 13 14:02:49 EST 2002
#
# The authors have placed this program in the public
# domain; they make no warranty and accept no liability
# for this program.
#
# RCS Info (may not be true date or author):
#
#   $Author: hc3 $
#   $Date: 2002/01/13 20:36:19 $
#   $RCSfile: hpcm_submit,v $
#   $Revision: 1.3 $

extensions=".c .cc .java .p .lsp"
files=""

case "$1" in
    "" | -*)
	echo "
hpcm_submit problem [file ...]

    Submits the files for the problem.  If a file
    has no extension and is not readable, a search is
    made for a readable file with one of the following
    extensions added:

    	$extensions
    
    If exactly one such readable file is found, that
    file is used.
    
    If no files are given, the problem is used as a
    single file name (possibly with extension added)."

	exit 1
	;;
esac

problem="$1"
if test $# -gt 1
then
    shift
fi

files=""
for file in "$@"
do
    case "$file" in
	*.* )
	    ;;
	* )
	    if test \! -r "$file"
	    then
		found=no
		f="$file"
		for e in $extensions
		do
		    if test -r "$f$e"
		    then
		        if test $found = yes
			then
			    echo too many files \
			         "$f.*" found
			    exit 1
			fi
			file="$f$e"
			found=yes
		    fi
		done
	    fi
	    ;;
    esac

    if test \! -r "$file"
    then
    	echo cannot read "$file"
	exit 1
    fi

    files="$files $file"
done

# Submit program files by email.
#
( echo Subject: submit $problem; \
  for file in $files; \
  do \
      echo ""; \
      echo HPCM_BEGIN "$file"; \
      cat "$file" | sed -e '/^/s//../'; \
      echo HPCM_END "$file"; \
  done ) \
| hpcm_sendmail
